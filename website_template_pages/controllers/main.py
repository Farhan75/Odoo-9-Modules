# -*- coding: utf-8 -*-
import openerp.http as http
from openerp.http import request
import logging
_logger = logging.getLogger(__name__)
import werkzeug
import base64
import re
import json
import openerp
import unicodedata
from openerp.tools import html_escape as escape, ustr, image_resize_and_sharpen, image_save_for_web
# optional python-slugify import (https://github.com/un33k/python-slugify)
try:
    import slugify as slugify_lib
except ImportError:
    slugify_lib = None
    
class WebsiteTemplatePages(http.Controller):    
    
    @http.route('/template/pages', website=True, type='json', auth="user")
    def website_template_pages_load(self, **kw):
        
        values = {}
	for field_name, field_value in kw.items():
            values[field_name] = field_value
            
        page_templates = request.env['ir.ui.view'].search([('is_webpage_template','=',True)])
        
        html_string = ""
        for page_template in page_templates:
            html_string += "<div class=\"sythil_page_template\" data-template=\"" + str(page_template.id) + "\">\n"
            html_string += "    <img src=\"data:image/jpeg;base64," + str(page_template.image) + "\"/><br/>\n"
            html_string += "    " + page_template.name + "<br/>\n"
            html_string += "    <br/>\n"
            html_string += "</div>\n"
        
        return {'html_string': html_string}

    @http.route('/template/pages/save', website=True, type='json', auth="user")
    def website_template_pages_save(self, **kw):

        values = {}
	for field_name, field_value in kw.items():
            values[field_name] = field_value

        view_id = values['view_id']
        
        current_view = request.env['ir.ui.view'].browse( int( view_id) )
                
        #Create the new template page using the content of the current page
        new_xml_id = request.env['website'].new_page(current_view.name + " - Template", current_view.xml_id)
        
        #We need to modify the new page to classify it as a template
        new_view = request.env['ir.ui.view'].search([('key','=',new_xml_id)])
        new_view.is_webpage_template = True

        #In the future we will generate the image put for now we just use a placeholder
        new_view.image = "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"

        return {'code': 'good'}

    @http.route('/template/pages/new', website=True, type='json', auth="user")
    def website_template_pages_new(self, **kw):
        
        values = {}
	for field_name, field_value in kw.items():
            values[field_name] = field_value
        
        page_template = request.env['ir.ui.view'].browse( int(values['template_id']) )
        s = ustr(values['page_name'])
	uni = unicodedata.normalize('NFKD', s).encode('ascii', 'ignore').decode('ascii')
	slug = re.sub('[\W_]', ' ', uni).strip().lower()
        slug = re.sub('[-\s]+', '-', slug)
        page_name = slug
        template_module = "website"
        page_xmlid = "%s.%s" % (template_module, page_name)
        website_id = request.env.context.get('website_id')
        key = template_module + '.' + page_name
        
        #Create a new view with the content of the page template
        page = request.env['ir.ui.view'].create({'website_id': website_id, 'key': key, 'arch': page_template.arch.replace('website_template_pages.placeholder', page_xmlid), 'name': page_name, 'page': True, 'type': 'qweb', 'xml_id': page_xmlid})
        
        return {'page_name': page_name}